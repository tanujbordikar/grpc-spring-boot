package com.dev.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.dev.Author;
import com.dev.Book;
import com.dev.BookAuthorServiceGrpc.BookAuthorServiceImplBase;
import com.dev.dto.AuthorEntity;
import com.dev.repository.AuthorRepository;
import com.dev.repository.BookRepository;

import io.grpc.stub.StreamObserver;

@Service
public class AuthorBookGrpcService extends BookAuthorServiceImplBase {
	 @Autowired
	    private AuthorRepository authorRepo;

	    @Autowired
	    private BookRepository bookRepo;

	@Override
	public void getAuthor(Author request, StreamObserver<Author> responseObserver) {
		AuthorEntity entity = new AuthorEntity();
		entity = authorRepo.findById(request.getAuthorId()).orElse(null);
        if (entity != null) {
            Author author = Author.newBuilder()
                    .setAuthorId(entity.getAuthorId())
                    .setFirstName(entity.getFirstName())
                    .setLastName(entity.getLastName())
                    .setGender(entity.getGender())
                    .build();
            responseObserver.onNext(author);
        }
        responseObserver.onCompleted();
	}

	@Override
	public void getBooksByAuthor(Author request, StreamObserver<Book> responseObserver) {
		// TODO Auto-generated method stub
		super.getBooksByAuthor(request, responseObserver);
	}

	@Override
	public StreamObserver<Book> getExpensiveBook(StreamObserver<Book> responseObserver) {
		// TODO Auto-generated method stub
		return super.getExpensiveBook(responseObserver);
	}
	
}
